PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE alembic_version (
	version_num VARCHAR(32) NOT NULL
);
INSERT INTO "alembic_version" VALUES('13039747aa3');
CREATE TABLE tags (
	id INTEGER NOT NULL, 
	name VARCHAR(50) NOT NULL, 
	seotitle VARCHAR(128), 
	seokey VARCHAR(128), 
	seodesc VARCHAR(300), 
	thumbnail VARCHAR(255), 
	template VARCHAR(255), 
	body TEXT, 
	body_html TEXT, 
	PRIMARY KEY (id)
);
CREATE TABLE links (
	id INTEGER NOT NULL, 
	anchor VARCHAR(64) NOT NULL, 
	title VARCHAR(128), 
	url VARCHAR(255) NOT NULL, 
	note VARCHAR(200), 
	PRIMARY KEY (id)
);
CREATE TABLE labels (
	id INTEGER NOT NULL, 
	slug VARCHAR(32) NOT NULL, 
	title VARCHAR(100) NOT NULL, 
	html TEXT NOT NULL, 
	PRIMARY KEY (id)
);
CREATE TABLE redirects (
	id INTEGER NOT NULL, 
	old_path VARCHAR(128) NOT NULL, 
	new_path VARCHAR(128) NOT NULL, 
	note VARCHAR(400), 
	PRIMARY KEY (id)
);
CREATE TABLE friendlinks (
	id INTEGER NOT NULL, 
	anchor VARCHAR(64) NOT NULL, 
	title VARCHAR(128), 
	url VARCHAR(255) NOT NULL, 
	actived BOOLEAN, 
	note VARCHAR(400), "order" INTEGER, 
	PRIMARY KEY (id), 
	CHECK (actived IN (0, 1))
);
CREATE TABLE flatpages (
	id INTEGER NOT NULL, 
	slug VARCHAR(32) NOT NULL, 
	title VARCHAR(100) NOT NULL, 
	seotitle VARCHAR(200), 
	seokey VARCHAR(128), 
	seodesc VARCHAR(400), 
	template VARCHAR(255), 
	body TEXT NOT NULL, 
	body_html TEXT NOT NULL, 
	PRIMARY KEY (id)
);
CREATE TABLE categories (
	id INTEGER NOT NULL, 
	slug VARCHAR(64) NOT NULL, 
	longslug VARCHAR(255) NOT NULL, 
	name VARCHAR(64) NOT NULL, 
	parent_id INTEGER, 
	seotitle VARCHAR(128), 
	seokey VARCHAR(128), 
	seodesc VARCHAR(300), 
	thumbnail VARCHAR(255), 
	template VARCHAR(255), 
	article_template VARCHAR(255), 
	body TEXT, 
	body_html TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(parent_id) REFERENCES categories (id)
);
INSERT INTO "categories" VALUES(1,'default','default','Default',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
CREATE TABLE roles (
	id INTEGER NOT NULL, 
	name VARCHAR(64), 
	"default" BOOLEAN, 
	permissions INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (name), 
	CHECK ("default" IN (0, 1))
);
INSERT INTO "roles" VALUES(1,'Moderator',0,12);
INSERT INTO "roles" VALUES(2,'Administrator',0,255);
INSERT INTO "roles" VALUES(3,'User',1,4);
CREATE TABLE topics (
	id INTEGER NOT NULL, 
	slug VARCHAR(64) NOT NULL, 
	name VARCHAR(64) NOT NULL, 
	seotitle VARCHAR(128), 
	seokey VARCHAR(128), 
	seodesc VARCHAR(300), 
	thumbnail VARCHAR(255), 
	template VARCHAR(255), 
	body TEXT, 
	body_html TEXT, 
	PRIMARY KEY (id)
);
CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR(64), 
	username VARCHAR(64), 
	name VARCHAR(64), 
	role_id INTEGER, 
	password_hash VARCHAR(128), 
	confirmed BOOLEAN, 
	about_me VARCHAR(1000), 
	member_since DATETIME, 
	last_seen DATETIME, 
	avatar_hash VARCHAR(32), 
	PRIMARY KEY (id), 
	FOREIGN KEY(role_id) REFERENCES roles (id), 
	CHECK (confirmed IN (0, 1))
);
INSERT INTO "users" VALUES(1,'admin@it-arzamas.ru','admin',NULL,2,'pbkdf2:sha1:1000$nG1jIQaj$6c886409361aa2a953d9060cc6a049880082a0aa',1,NULL,'2016-11-25 19:28:31.924534','2016-11-25 19:28:31.924566',NULL);
CREATE TABLE articles (
	id INTEGER NOT NULL, 
	slug VARCHAR(200), 
	title VARCHAR(200) NOT NULL, 
	seotitle VARCHAR(200), 
	seokey VARCHAR(128), 
	seodesc VARCHAR(300), 
	category_id INTEGER NOT NULL, 
	topic_id INTEGER, 
	thumbnail VARCHAR(255), 
	thumbnail_big VARCHAR(255), 
	template VARCHAR(255), 
	summary VARCHAR(2000), 
	body TEXT NOT NULL, 
	body_html TEXT, 
	published BOOLEAN, 
	ontop BOOLEAN, 
	recommend BOOLEAN, 
	hits INTEGER, 
	author_id INTEGER, 
	created DATETIME, 
	last_modified DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(author_id) REFERENCES users (id), 
	FOREIGN KEY(category_id) REFERENCES categories (id), 
	FOREIGN KEY(topic_id) REFERENCES topics (id), 
	CHECK (published IN (0, 1)), 
	CHECK (ontop IN (0, 1)), 
	CHECK (recommend IN (0, 1))
);
CREATE TABLE article_tags (
	article_id INTEGER, 
	tag_id INTEGER, 
	FOREIGN KEY(article_id) REFERENCES articles (id) ON DELETE CASCADE, 
	FOREIGN KEY(tag_id) REFERENCES tags (id) ON DELETE CASCADE
);
CREATE TABLE settings (
	id INTEGER NOT NULL, 
	name VARCHAR(128) NOT NULL, 
	rawvalue VARCHAR(4096) NOT NULL, 
	formatter VARCHAR(16) NOT NULL, 
	builtin BOOLEAN, 
	description VARCHAR(255), 
	PRIMARY KEY (id), 
	UNIQUE (name), 
	CHECK (builtin IN (0, 1))
);
CREATE UNIQUE INDEX ix_tags_name ON tags (name);
CREATE UNIQUE INDEX ix_categories_longslug ON categories (longslug);
CREATE INDEX ix_roles_default ON roles ("default");
CREATE UNIQUE INDEX ix_topics_slug ON topics (slug);
CREATE UNIQUE INDEX ix_users_email ON users (email);
CREATE UNIQUE INDEX ix_users_username ON users (username);
COMMIT;
